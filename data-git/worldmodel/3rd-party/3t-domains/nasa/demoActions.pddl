(in-package :ap)

(format t "~%Defining first nasa demo...")

(NEW-PREDICATE '(JOBS-DONE1 ?AGENT2 - CREW) NASA-DOMAIN)

(DEFINE (DURATIVE-ACTION DO-JOBS) :PARAMETERS (COMMON-LISP-USER::?AGENT4 - CREW) :VARS
        (COMMON-LISP-USER::?AGENT3 - CREW ?ARM - ROBOTIC-ARM ?SCOOP - SQUARE-SCOOP ?CLB
         - CREW-LOCK-BAG ?SPARE - DC-TO-DC-CONVERTER-UNIT ?COVER - STANCHION-MOUNT-COVER
         ?L - (LOCATED DDCUS01A) ?BAG - MEDIUM-ORU-BAG ?ADCO - ADCO ?PHALCON - PHALCON
         ?ODIN - ODIN ?THOR - THOR)
        :CONDITION
        (AND (AT START (NOT (= COMMON-LISP-USER::?AGENT3 COMMON-LISP-USER::?AGENT4)))
             (AT START (NOT (= (OPERATOR ?ARM) COMMON-LISP-USER::?AGENT3)))
             (AT START (NOT (= (OPERATOR ?ARM) COMMON-LISP-USER::?AGENT4)))
             (OVER ALL (BAG-SIZE-FOR CETA-LIGHT1 ?BAG))
             (AT START (NOT (= DDCUS01A ?SPARE))) (AT START (CONTAINS ?COVER ?SPARE))
             (AT START (CONTAINS ?CLB ?SCOOP)))
        :EXPANSION
        (SEQUENTIAL
         (PARALLEL
          (SEQUENTIAL (DEACTIVATE-RGA_A ?ADCO DDCUS01A)
           (RECONFIG-GPS-POWER_A ?ADCO DDCUS01A) (SHUTDOWN-CMG_A ?ADCO DDCUS01A))
          (SEQUENTIAL (CONFIGURE-SARJ_A ?PHALCON SARJ-PORT)
           (CONFIGURE-SARJ_A ?PHALCON SARJ-STARBOARD))
          (SEQUENTIAL (TRANSITION-MDM_A ?ODIN STR-MDM)
           (TRANSITION-P1-MDM_A ?ODIN P1-MDM2) (TRANSITION-P3-MDM_A ?ODIN P3-MDM1)))
         (LOCATED COMMON-LISP-USER::?AGENT3 AIRLOCK) (LOCATED ?BAG AIRLOCK)
         (LOCATED FISH-STRINGER1 AIRLOCK) (LOCATED ?CLB AIRLOCK)
         (LOCATED ?COVER AIRLOCK) (LOCATED COMMON-LISP-USER::?AGENT4 AIRLOCK)
         (PARALLEL (PREPARE-FOR-EVA_A COMMON-LISP-USER::?AGENT3)
          (PREPARE-FOR-EVA_A COMMON-LISP-USER::?AGENT4))
         (PARALLEL (POSSESSES COMMON-LISP-USER::?AGENT4 ?BAG)
          (POSSESSES COMMON-LISP-USER::?AGENT3 FISH-STRINGER1))
         (PARALLEL (RETRIEVE-ITEM_A COMMON-LISP-USER::?AGENT4 CETA-LIGHT1)
          (INSTALL-ITEM_A COMMON-LISP-USER::?AGENT3 POWER-CABLE1))
         (INSTALL-ITEM_A COMMON-LISP-USER::?AGENT3 FQD-JUMPER1)
         (PARALLEL (LOCATED COMMON-LISP-USER::?AGENT3 AIRLOCK)
          (LOCATED COMMON-LISP-USER::?AGENT4 AIRLOCK))
         (SITE-PREPPED-FOR-R&R COMMON-LISP-USER::?AGENT3 DDCUS01A)
         (SHUTDOWN-ETCS-LOOP_A ?THOR DDCUS01A) (DEACTIVATE-DDCU_A ?PHALCON DDCUS01A)
         (POWERDOWN-DDCU_A ?PHALCON DDCUS01A) (LOCATED COMMON-LISP-USER::?AGENT4 ?L)
         (REPLACED COMMON-LISP-USER::?AGENT4 DDCUS01A)
         (PARALLEL (LOCATED COMMON-LISP-USER::?AGENT3 AIRLOCK)
          (LOCATED COMMON-LISP-USER::?AGENT4 AIRLOCK))
         (LOCATED COMMON-LISP-USER::?AGENT4 INTRA-VEHICLE)
         (LOCATED DDCUS01A INTRA-VEHICLE)
         (LOCATED COMMON-LISP-USER::?AGENT3 INTRA-VEHICLE) (LOCKED HATCH)
         (PARALLEL (PREPARE-FOR-REPRESS_A COMMON-LISP-USER::?AGENT3)
          (PREPARE-FOR-REPRESS_A COMMON-LISP-USER::?AGENT4)))
        :EFFECT (AT END (JOBS-DONE1 COMMON-LISP-USER::?AGENT4)))

(DEFINE (PROBLEM DONE-JOBS1) (:DOMAIN NASA-DOMAIN) (:SITUATION PHALCON-EVA)
           (:INIT (LOCATION-FOR DDCUS01A DDCUS01A-LOC) (POSSESSES SALLY S1-BEAM-BAG)) (:DEADLINE 390.0)
           (:GOAL (JOBS-DONE1 SALLY)))


(format t "~%Defining second nasa demo...")

(NEW-PREDICATE '(JOBS-DONE2 ?AGENT1 - CREW) NASA-DOMAIN)

(DEFINE (DURATIVE-ACTION DO-JOBS2) :PARAMETERS (?AGENT1 - CREW) :VARS
           (?AGENT2 - CREW ?ARM - ROBOTIC-ARM ?STP - SAFETY-TETHER-PACK) :CONDITION
           (AND (AT START (NOT (= ?AGENT1 ?AGENT2))) (AT START (NOT (= (OPERATOR ?ARM) ?AGENT1)))
                (AT START (NOT (= (OPERATOR ?ARM) ?AGENT2))) (POSSESSES ?AGENT1 ?STP))
           :EXPANSION
           (SEQUENTIAL (LOCATED ?AGENT1 AIRLOCK) (LOCATED ?AGENT2 AIRLOCK)
            (PARALLEL (PREPARE-FOR-EVA_A ?AGENT1) (PREPARE-FOR-EVA_A ?AGENT2))
            (PARALLEL (LOCATED ?AGENT1 P3-P4-JUNCTURE) (LOCATED ?AGENT2 P3-P4-JUNCTURE))
            (REROUTED ?AGENT1 NH3-JUMPER-P3-P4)
            (PARALLEL (LOCATED ?AGENT1 P5-P6-JUNCTURE) (LOCATED ?AGENT2 P1-ATA-PANEL))
            (FINAL-QDS-OPENED ?AGENT1 NH3) (VENT-TOOL-SETUP_A ?AGENT1 VENT-TOOL1)
            (P6-LINES-VENTED ?AGENT1 P6-RADIATOR) (VENT-TOOL-CLEAN-UP_A ?AGENT1 VENT-TOOL1)
            (PARALLEL (LOCATED ?AGENT1 AIRLOCK) (LOCATED ?AGENT2 AIRLOCK))
            (LOCATED ?AGENT2 INTRA-VEHICLE) (LOCATED ?AGENT1 INTRA-VEHICLE) (LOCKED HATCH)
            (PARALLEL (PREPARE-FOR-REPRESS_A ?AGENT1) (PREPARE-FOR-REPRESS_A ?AGENT2)))
           :EFFECT (AT END (JOBS-DONE2 ?AGENT1)))

(DEFINE (PROBLEM DONE-JOBS2) (:DOMAIN NASA-DOMAIN) (:SITUATION PHALCON-EVA)
           (:INIT (LOCATION-FOR DDCUS01A DDCUS01A-LOC) (POSSESSES SALLY S1-BEAM-BAG)) (:DEADLINE 390.0)
           (:GOAL (JOBS-DONE2 SALLY)))

(format t "~%Defining third nasa demo...")

(NEW-PREDICATE '(JOBS-DONE3 ?AGENT3 ?AGENT4 - CREW) NASA-DOMAIN)
(DEFINE (DURATIVE-ACTION DO-JOBS3) :PARAMETERS (?AGENT3 ?AGENT4 - CREW) :VARS
           (?ARM - ROBOTIC-ARM ?BEAM-BAG - S1-BEAM-BAG) :CONDITION
           (AND (AT START (NOT (= ?AGENT3 ?AGENT4))) (AT START (NOT (= (OPERATOR ?ARM) ?AGENT3)))
                (AT START (NOT (= (OPERATOR ?ARM) ?AGENT4))))
           :EXPANSION
           (SEQUENTIAL (POSSESSES ?AGENT4 ?BEAM-BAG)
            (PARALLEL (INSTALLED-ITEM ?AGENT4 S1-RADIATOR-STOW-BEAM) (LOCATED ?AGENT3 AIRLOCK))
            (LOCATED ?AGENT4 AIRLOCK) (LOCATED ?AGENT4 INTRA-VEHICLE) (LOCATED ?AGENT3 INTRA-VEHICLE)
            (LOCKED HATCH) (PARALLEL (PREPARE-FOR-REPRESS_A ?AGENT3) (PREPARE-FOR-REPRESS_A ?AGENT4))
            (DECON-COMPLETE_A ?AGENT4))
           :EFFECT (AT END (JOBS-DONE3 ?AGENT3 ?AGENT4)))

(DEFINE (PROBLEM DONE-JOBS3) (:DOMAIN NASA-DOMAIN) (:SITUATION PHALCON-EVA)
           (:INIT (LOCATION-FOR DDCUS01A DDCUS01A-LOC) (POSSESSES SALLY S1-BEAM-BAG)
            (VENTED SALLY EAS-JUMPERS) (VENTED SALLY P1-P5) (OPEN QD14) (OPEN QDF185) (OPEN ATA1)
            (OPEN QD15) (POSSESSES SALLY VENT-TOOL1) (POSSESSES SALLY MUT-EE2)
            (TETHERED_TO ISS-SAFETY-TETHER1 BOB) (TETHERED_TO ISS-SAFETY-TETHER2 SALLY)
            (P6-LINES-VENTED SALLY P6-RADIATOR) (POSSESSED_BY MUT-EE2 SALLY)
            (POSSESSED_BY VENT-TOOL1 SALLY) (VENT-TOOL-SETUP_A SALLY VENT-TOOL1)
            (MAKE-OPEN BOB QD15) (MAKE-OPEN SALLY QD14) (HASACCESSTO SALLY VENT-TOOL1)
            (HASACCESSTO SALLY MUT-EE2) (VENT-TOOL-CLEAN-UP_A SALLY VENT-TOOL1)
            (CHECK-FOR-LEAKS_A BOB) (CHECK-FOR-LEAKS_A SALLY) (EGRESS-BY-TWO_A BOB ISS-SAFETY-TETHER1)
            (INSTALLED-ITEM SALLY MUT-EE2) (DISASSEMBLED SALLY VENT-TOOL1)
            (SAFETY-TETHER-FOR-EGRESS_A SALLY ISS-SAFETY-TETHER1)
            (INSTALLED-ITEM-IN-PLACE SALLY NH3-JUMPER-P3-P4) (INSTALLED NH3-JUMPER-P3-P4)
            (ATA-CONFIGURATION FILL) (OPEN-ATA-TANK_A MIKE ATA1) (OPEN-ATA-TANK_A MIKE ATA1)
            (CONTAINED_BY VT-ADAPTER1 VTE-BAG1) (CONTAINED_BY VENT-TOOL1 VTE-BAG1)
            (FINAL-QDS-OPENED SALLY NH3) (CONFIGURE_ATA_A BOB FILL) (LOCATED WIFA1 P1-ATA-PANEL)
            (LOCATED MUT-EE1 P1-ATA-PANEL) (LOCATED STP1 P1-ATA-PANEL) (LOCATED BOB P1-ATA-PANEL)
            (LOCATED RATCHET-WRENCH1 P1-ATA-PANEL) (LOCATED PGT2 P6-Z-FACE1)
            (LOCATED PGT3 P6-Z-FACE1) (LOCATED SALLY P6-Z-FACE1) (LOCATED S1-BEAM-BAG P6-Z-FACE1)
            (LOCATED S1-INBOARD-STOW-BEAM P6-Z-FACE1) (LOCATED STP2 P6-Z-FACE1)
            (LOCATED WIFA2 P6-Z-FACE1) (LOCATED MUT-EE2 P6-Z-FACE1)
            (LOCATED SQUARE-SCOOP2 P1-ATA-PANEL) (LOCATED PGT1 P1-ATA-PANEL)
            (LOCATED ISS-SAFETY-TETHER4 P6-Z-FACE1) (LOCATED S1-OUTBOARD-STOW-BEAM P6-Z-FACE1)
            (LOCATED ISS-SAFETY-TETHER3 P1-ATA-PANEL) (ASSEMBLED SALLY VENT-TOOL1)
            (PREPARE-FOR-EVA_A BOB) (PREPARE-FOR-EVA_A SALLY) (REROUTED SALLY NH3-JUMPER-P3-P4))
           (:DEADLINE 390.0) (:GOAL (JOBS-DONE3 BOB SALLY)))


